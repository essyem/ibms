<!-- finance/templates/finance/transaction_form.html -->
{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h2>{% if object %}Edit{% else %}Add{% endif %} Transaction</h2>
    
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="row">
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header">Transaction Details</div>
                    <div class="card-body">
                        <div class="form-group">
                            {{ form.type.label_tag }}
                            {{ form.type }}
                            {{ form.type.errors }}
                        </div>
                        
                        <div class="form-group">
                            {{ form.category.label_tag }}
                            {{ form.category }}
                            {{ form.category.errors }}
                        </div>
                        
                        <div class="form-group">
                            {{ form.amount.label_tag }}
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">$</span>
                                </div>
                                {{ form.amount }}
                            </div>
                            {{ form.amount.errors }}
                        </div>
                        
                        <div class="form-group">
                            {{ form.date.label_tag }}
                            {{ form.date }}
                            {{ form.date.errors }}
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header">Additional Information</div>
                    <div class="card-body">
                        <div class="form-group">
                            {{ form.payment_method.label_tag }}
                            {{ form.payment_method }}
                            {{ form.payment_method.errors }}
                        </div>
                        
                        <div class="form-group">
                            {{ form.reference.label_tag }}
                            {{ form.reference }}
                            {{ form.reference.errors }}
                        </div>
                        
                        <div class="form-group">
                            {{ form.description.label_tag }}
                            {{ form.description }}
                            {{ form.description.errors }}
                        </div>
                        
                        <div class="form-group">
                            {{ form.document.label_tag }}
                            {{ form.document }}
                            {{ form.document.errors }}
                            {% if object.document %}
                                <div class="mt-2">
                                    <a href="{{ object.document.url }}" target="_blank">
                                        View current document
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <button type="submit" class="btn btn-primary">Save Transaction</button>
        <a href="{% url 'finance:transaction_list' %}" class="btn btn-secondary">Cancel</a>
    </form>
</div>

<script>
// JavaScript to filter categories based on transaction type
function filterCategories(transactionType) {
    const categorySelect = document.querySelector('#id_category');
    const url = `/finance/api/categories/?type=${transactionType}`;
    
    fetch(url)
        .then(response => response.json())
        .then(data => {
            categorySelect.innerHTML = '';
            data.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                categorySelect.appendChild(option);
            });
        });
}

// Initialize categories if type is already selected
document.addEventListener('DOMContentLoaded', function() {
    const typeSelect = document.querySelector('#id_type');
    if (typeSelect.value) {
        filterCategories(typeSelect.value);
    }
});
</script>
{% endblock %}